{"version":3,"sources":["../../src/routes/help.js"],"names":["router","EMAIL_PASS","config","parsed","post","req","res","servername","headers","origin","firstName","lastName","email","message","subject","body","name","undefined","transporter","createTransport","service","port","secure","auth","user","pass","tls","rejectUnauthorized","emailNum","emailAddr","alpha","split","num","emailArr","i","length","indexOf","toString","supportId","Date","valueOf","helpRequestMessage","from","to","includes","text","sendMail","requestMsgErr","requestMsgInfo","responseCode","helpConfirmMessage","confirmMsgErr","confirmMsgInfo"],"mappings":"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","file":"help.js","sourcesContent":["// Create API Users Router\nimport { Router } from 'express';\nimport nodemailer from 'nodemailer';\nimport dotenv from 'dotenv';\n\nimport jsonReponse from '../helpers/response';\n\nconst router = Router();\n\nconst { EMAIL_PASS } = dotenv.config().parsed;\n\n/*\n******HELP ROUTES******\n*/\n\n// Accepts a help contact request. Returns a confirmation message.\nrouter.post('/', (req, res) => {\n  const servername = req.headers.origin;\n\n  const { firstName, lastName, email, message, subject } = req.body;\n  const name = firstName !== undefined ? `${firstName} ${lastName}` : req.body.name;\n  const transporter = nodemailer.createTransport({\n    service: 'Gmail',\n    port: 465,\n    secure: true,\n    auth: {\n      user: 'ssmith@wombatweb.us',\n      pass: EMAIL_PASS,\n    },\n    tls: {\n      rejectUnauthorized: false,\n    },\n  });\n\n  const emailNum = (emailAddr) => {\n    const alpha = 'abcdefghijklmnopqrstuvwxyz@.ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#$%&\\'*+-/=?^_`{|}~\"(),:;<>@[\\\\]'.split('');\n    let num = '';\n    const emailArr = emailAddr.split('');\n\n    for (let i = 0; i < emailArr.length; i += 1) {\n      if (emailArr.indexOf('@') > i) {\n        num += alpha.indexOf(emailArr[i]).toString();\n      } else {\n        return num;\n      }\n    }\n    return num;\n  };\n\n  const supportId = `${emailNum(email)}${(new Date().valueOf())}`;\n\n  const helpRequestMessage = {\n    from: [email],\n    to: 'ssmith@wombatweb.us',\n    subject: servername.includes('designbright') ? `Help Request #${supportId} - ${subject}` : subject,\n    text: servername.includes('designbright') ? `\nA support request for www.designbright.org has been submitted.\n\nName: ${name}\nEmail: ${email}\n\nMessage:\n${message}\n\nThank you,\nDesign Bright Support\n    ` : `\nHello Simeon,\n\nMy name is ${name} and my email is ${email}.\n\n${message}\n\nThank you,\n${name}\n  `,\n  };\n\n  transporter.sendMail(\n    helpRequestMessage,\n    (requestMsgErr, requestMsgInfo) => {\n      if (requestMsgErr) {\n        return jsonReponse(\n          requestMsgErr.responseCode,\n          requestMsgErr,\n          'There was an error sending your support request. Please send an email to help@designbright.org',\n          res);\n      } else if (requestMsgInfo) {\n        const helpConfirmMessage = {\n          from: servername.includes('designbright') ? 'help@designbright.org' : 'ssmith@wombatweb.us',\n          to: [email],\n          subject: servername.includes('designbright') ? `Help Request #${supportId} - ${subject}` : `Thank you for contact me. - ${subject}`,\n          text: servername.includes('designbright') ? `\nHello ${name},\n\nWe have received the request below for help. We look forward to helping you. Please allow 24-48 hours for a response. \n\nHelp Request:\n${message}\n\nThank you,\nDesign Bright Support\n          ` : `\nHello ${name},\n\nThank you for reaching out to me. I will get back to you within 24 hours.\n\nThank you,\nSimeon Smith\nssmith@wombatweb.us\n\nOriginal Message:\nName: ${name}\nEmail: ${email}\nSubject: ${subject}\nMessage:\n${message}\n          `,\n        };\n\n        return transporter.sendMail(\n          helpConfirmMessage,\n          (confirmMsgErr, confirmMsgInfo) => {\n            if (confirmMsgErr) {\n              return jsonReponse(\n                confirmMsgErr.responseCode,\n                confirmMsgErr,\n                'Your support request failed. Please email help@designbright.org',\n                res);\n            } else if (confirmMsgInfo) {\n              return jsonReponse(\n                200,\n                confirmMsgInfo,\n                'You support request was successfully sent.',\n                res);\n            }\n            return jsonReponse(\n              404,\n              {},\n              'Your support request failed. Please email help@designbright.org',\n              res);\n          },\n        );\n      }\n      return jsonReponse(\n        404,\n        {},\n        'Your support request failed. Please email help@designbright.org',\n        res);\n    },\n  );\n});\n\n// Exporting router as default.\nexport default router;\n"]}