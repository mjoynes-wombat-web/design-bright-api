{"version":3,"sources":["../../src/routes/campaigns.js"],"names":["upload","router","STRIPE_SECRET","config","parsed","stripe","get","req","res","Object","keys","query","length","search","sort","page","getCampaignsResults","statusCode","message","getCampaignsErr","id","params","campaignId","results","campaignInfo","startDate","accessToken","user","parseInt","app_metadata","nonProfitID","nonprofitId","error","original","patch","getCampaignId","campaignContent","body","getCampaignInfoResults","createContentResults","updateCampaignInfoResults","updateCampaignInfoErr","createContentError","getCampaignError","code","post","single","campaignName","imageType","imageAlt","image","file","imageDimensions","imgType","width","height","dimensions","originalName","originalname","fileName","substring","lastIndexOf","Date","toISOString","public_id","folder","tags","success","http_code","newCampaign","createCamapignResults","createCampaignErr","getUserInfoErr","email","token","amount","description","userInfo","charge","receipt_email","source","currency","metadata","firstName","lastName","userType","charges","create","then","chargeConf","paid","amountCharged","toString","donateResults","data","databaseMessage","slice","getCampaignErr","catch","chargeErr"],"mappings":"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","file":"campaigns.js","sourcesContent":["// Create API Users Router\nimport { Router } from 'express';\nimport multer from 'multer';\nimport Stripe from 'stripe';\nimport dotenv from 'dotenv';\n\nimport { getUserInfo } from '../models/Auth0';\nimport { getCampaignById, getCampaignContent, createCampaign, createContent, updateCampaignInfo, donateToCampaign, getCampaigns } from '../models/campaigns';\nimport jsonResponse from '../helpers/response';\nimport { uploadCampaignImage } from '../models/Cloudinary';\nimport requireAuth from '../helpers/requireAuth';\n\nconst upload = multer();\nconst router = Router();\n\nconst { STRIPE_SECRET } = dotenv.config().parsed;\n\nconst stripe = Stripe(STRIPE_SECRET);\n\n/*\n******CAMPAIGN ROUTES******\n*/\n\n// Returns the list of campaigns based on the search as sort queries.\nrouter.get('/', (req, res) => {\n  if (Object.keys(req.query).length > 0) {\n    let search;\n    let sort;\n    let page;\n    if (req.query.page) {\n      search = req.query.search;\n      sort = req.query.sort;\n      page = req.query.page;\n    } else {\n      search = req.query.search;\n      sort = req.query.sort;\n      page = 1;\n    }\n    if (sort) {\n      return getCampaigns(\n        {\n          page,\n          search,\n          sort,\n        },\n        getCampaignsResults => jsonResponse(\n          getCampaignsResults.statusCode,\n          getCampaignsResults,\n          getCampaignsResults.message,\n          res),\n        getCampaignsErr => jsonResponse(\n          getCampaignsErr.statusCode,\n          getCampaignsErr,\n          getCampaignsErr.message,\n          res),\n      );\n    }\n    return jsonResponse(\n      400,\n      {\n        search,\n        sort,\n        page,\n      },\n      'You are missing the sort method.',\n      res);\n  }\n  return jsonResponse(\n    400,\n    {},\n    'There were no queries provided.',\n    res);\n});\n\n// Returns the information for the campaign with the identity param.\nrouter.get('/:campaignId', (req, res) => {\n  const id = req.params.campaignId;\n  getCampaignContent(\n    id,\n    (results) => {\n      if (results.campaignInfo.startDate) {\n        return jsonResponse(\n          200,\n          results,\n          `This is the contents for the campaign id ${id}`,\n          res,\n        );\n      } else if ('accessToken' in req.query) {\n        getUserInfo(\n          req.query.accessToken,\n          (user) => {\n            if (parseInt(user.app_metadata.nonProfitID, 10) === results.campaignInfo.nonprofitId) {\n              return jsonResponse(\n                200,\n                results,\n                `This is the preview contents for the the campaign id ${id}`,\n                res,\n              );\n            }\n            return jsonResponse(\n              401,\n              {},\n              `You aren't authorize to preview the campaign id ${id}`,\n              res,\n            );\n          },\n          error => jsonResponse(\n            error.statusCode,\n            error.original,\n            'There was an error getting the user info.',\n            res),\n        );\n      } else {\n        return jsonResponse(\n          401,\n          {},\n          'There was no access token provided.',\n          res,\n        );\n      }\n      return null;\n    },\n    (error) => {\n      if (Object.keys(error).length) {\n        return jsonResponse(\n          500,\n          error,\n          'There was an error on the server.',\n          res,\n        );\n      }\n      return jsonResponse(\n        404,\n        error,\n        'You are trying to access a campaign that doesn\\'t exist.',\n        res,\n      );\n    },\n  );\n});\n\n// Accepts information changes to a campaign with the campaignId param.\n// Returns the update campaign information.\nrouter.patch('/edit/:campaignId', (req, res) => {\n  const getCampaignId = parseInt(req.params.campaignId, 10);\n  const { accessToken, campaignInfo, campaignContent } = req.body;\n  getUserInfo(\n    accessToken,\n    (user) => {\n      const nonprofitId = parseInt(user.app_metadata.nonProfitID, 10);\n      if (campaignInfo.nonprofitId === nonprofitId) {\n        getCampaignById(\n          getCampaignId,\n          (getCampaignInfoResults) => {\n            if (getCampaignInfoResults.nonprofitId === nonprofitId) {\n              return createContent(\n                getCampaignId,\n                campaignContent,\n                (createContentResults) => {\n                  if (getCampaignInfoResults.startDate === null) {\n                    return updateCampaignInfo(\n                      nonprofitId,\n                      campaignInfo,\n                      updateCampaignInfoResults => jsonResponse(\n                        updateCampaignInfoResults.statusCode,\n                        updateCampaignInfoResults,\n                        'The campaign changes were successfully saved.',\n                        res),\n                      updateCampaignInfoErr => jsonResponse(\n                        updateCampaignInfoErr.statusCode,\n                        updateCampaignInfoErr,\n                        updateCampaignInfoErr.message,\n                        res),\n                    );\n                  }\n                  return jsonResponse(\n                    200,\n                    createContentResults,\n                    'The campaign content was successfully saved.',\n                    res,\n                  );\n                },\n                createContentError => jsonResponse(\n                  304,\n                  createContentError,\n                  'The was an error saving the campaign content.',\n                  res,\n                ),\n              );\n            }\n            return jsonResponse(\n              401,\n              {\n                nonprofitId,\n                campaignId: getCampaignId,\n              },\n              'You are not authorized to edit this campaign.',\n              res,\n            );\n          },\n          getCampaignError => jsonResponse(\n            getCampaignError.code,\n            getCampaignError,\n            `The campaign with the id ${getCampaignId} could not be found.`,\n            res,\n          ),\n        );\n      }\n    },\n    error => jsonResponse(\n      error.statusCode,\n      error.original,\n      'There was an error getting the user info.',\n      res),\n  );\n});\n\nrouter.post('/upload/photo/:campaignId', upload.single('file'), (req, res) => {\n  const id = req.params.campaignId;\n  const { campaignName, imageType, imageAlt, nonprofitId } = req.body;\n  const image = req.file;\n\n  const imageDimensions = (imgType) => {\n    switch (imgType) {\n      case 'main':\n        return { width: 1440, height: 820 };\n      case 'left':\n        return { width: 235, height: 290 };\n      case 'right':\n        return { width: 235, height: 290 };\n      default:\n        return { width: 235, height: 290 };\n    }\n  };\n\n  const dimensions = imageDimensions(imageType);\n  const originalName = image.originalname;\n  const fileName = `${originalName.substring(0, originalName.lastIndexOf('.'))}-campaignId${id}-${(new Date()).toISOString()}`;\n\n  uploadCampaignImage(\n    image,\n    {\n      public_id: fileName,\n      folder: nonprofitId,\n      ...dimensions,\n      tags: [id, 'campaign-image', campaignName, imageAlt],\n    },\n    success => jsonResponse(\n      200,\n      success,\n      'Image created successfully.',\n      res,\n    ),\n    error => jsonResponse(\n      error.http_code,\n      error,\n      error.message,\n      res,\n    ),\n  );\n});\n\n// Accepts a new campaign information. Returns the new created campaign.\nrouter.post('/create', (req, res) => {\n  const { newCampaign, accessToken } = req.body;\n  if (requireAuth(accessToken)) {\n    getUserInfo(\n      accessToken,\n      (user) => {\n        const nonprofitId = user.app_metadata.nonProfitID;\n\n        createCampaign(\n          nonprofitId,\n          newCampaign,\n          createCamapignResults => jsonResponse(\n            createCamapignResults.statusCode,\n            createCamapignResults,\n            'Your campaign was successfully created.',\n            res),\n          createCampaignErr => jsonResponse(\n            createCampaignErr.statusCode,\n            createCampaignErr.error,\n            createCampaignErr.message,\n            res),\n        );\n      },\n      getUserInfoErr => jsonResponse(\n        getUserInfoErr.statusCode,\n        getUserInfoErr.original,\n        'There was an error getting the user info.',\n        res),\n    );\n  } else {\n    jsonResponse(\n      401,\n      { accessToken },\n      'The access token is not a valid access token.',\n      res,\n    );\n  }\n});\n\n\nrouter.post('/donate/:id', (req, res) => {\n  const { id } = req.params;\n  const { email, token, amount, description, userInfo } = req.body;\n\n  const charge = () => {\n    if (email) {\n      return {\n        receipt_email: email,\n        source: token.id,\n        amount,\n        description,\n        currency: 'usd',\n        metadata: {\n          campaignId: id,\n          firstName: userInfo.firstName,\n          lastName: userInfo.lastName,\n          email: userInfo.email,\n          userType: userInfo.userType,\n        },\n      };\n    }\n    return {\n      source: token.id,\n      amount,\n      description,\n      currency: 'usd',\n      metadata: {\n        campaignId: id,\n        firstName: userInfo.firstName,\n        lastName: userInfo.lastName,\n        email: userInfo.email,\n        userType: userInfo.userType,\n      },\n    };\n  };\n\n  stripe.charges.create(charge())\n    .then((chargeConf) => {\n      if (chargeConf.paid) {\n        const amountCharged = chargeConf.amount.toString();\n        return donateToCampaign(\n          id,\n          amount,\n          donateResults => jsonResponse(\n            donateResults.code,\n            {\n              ...donateResults.data,\n              databaseMessage: donateResults.message,\n            },\n            `Your donation of $${amountCharged.slice(0, amountCharged.length - 2)}.${amountCharged.slice(-2)} was successfully made.`,\n            res),\n          getCampaignErr => jsonResponse(\n            getCampaignErr.code,\n            { error: getCampaignErr.error },\n            getCampaignErr.message,\n            res),\n        );\n      }\n      return jsonResponse(\n        400,\n        { error: chargeConf },\n        'There was an error processing your payment.',\n        res);\n    })\n    .catch((chargeErr) => {\n      jsonResponse(\n        chargeErr.statusCode,\n        { error: chargeErr },\n        chargeErr.message,\n        res);\n    });\n});\n\n// Exporting router as default.\nexport default router;\n"]}